<!DOCTYPE html>
<html>
    <head>
        <title>UC TorchAI *Subject to Change*</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css' )}}">
    </head>
    <body>
        <h1>UC TorchAI *Subject to Change*</h1>
        <div class="container" id="container">
            <div class="plan-container" id="plan-container">
                <h2 id="plans">Saved Plans</h2>             
            </div>
            <div class="chat-container" id="chat-container">
                <h2 id="virtual-advisor">Virtual Advisor</h2>
                <div class="message-container" id="message-container">
                </div>
                <div class="input-container">
                    <input type="text" id="prompt" name="prompt" placeholder="Enter prompt...">
                    <button class="send-btn" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
        <script>
            function sendMessage() {
                var prompt = document.getElementById('prompt').value;
                addMessage('user', prompt);

                var xhttp = new XMLHttpRequest();
                xhttp.open("POST", "/");
                xhttp.setRequestHeader("Content-Type", "application/json");
                const body = {prompt: prompt};
                xhttp.send(JSON.stringify(body));

                xhttp.onload = function() {
                    addMessage('bot', xhttp.responseText);
                }
            }

            function addMessage(sender, message) {
                const chatContainer = document.getElementById('message-container');
                const messageElement = document.createElement('div');
                messageElement.classList.add('chat-message');
                messageElement.classList.add(sender + '-message');
                messageElement.innerText = message;

                if (sender == 'bot') {
                    const bookmarkBtn = document.createElement('button');
                    bookmarkBtn.classList.add('bookmark-btn');
                    bookmarkBtn.innerText = 'Save';
                    messageElement.appendChild(bookmarkBtn);

                    bookmarkBtn.addEventListener('click', function() {
                        const planContainer = document.getElementById('plan-container');
                        const plan = document.createElement('button');
                        plan.classList.add('plan');

                        const modal = document.createElement('div');
                        modal.classList.add('modal');

                        plan.addEventListener('click', function() {
                            openModal();
                        });

                        const closeBtn = document.createElement('button');
                        closeBtn.classList.add('close-btn');
                        closeBtn.addEventListener('click', function() {
                            closeModal();
                        });

                        const modalContent = document.createElement('p');
                        modalContent.classList.add('modal-content');
                        modalContent.textContent = message;

                        modal.appendChild(closeBtn);
                        modal.appendChild(modalContent);
                        planContainer.appendChild(plan);
                        planContainer.appendChild(modal);
                    });
                }
                chatContainer.appendChild(messageElement);
            }


            function openModal() {
                const modal = document.querySelector('.modal');
                modal.style.display = 'block';
            }

            function closeModal() {
                const modal = document.querySelector('.modal');
                modal.style.display = 'none';
            }


            window.onclick = function(event) {
                const modal = document.querySelector('modal');
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        </script>
    </body>
</html>